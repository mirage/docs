<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Conduit_lwt_unix (conduit-lwt-unix.Conduit_lwt_unix)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">conduit-lwt-unix</a> &#x00BB; Conduit_lwt_unix</nav><header><h1>Module <code>Conduit_lwt_unix</code></h1><p>Connection establishment using the <a href="http://ocsigen.org/lwt/api/Lwt_unix">Lwt_unix</a> library</p></header><nav class="toc"><ul><li><a href="#core-types">Core types</a></li><li><a href="#connection-and-listening">Connection and listening</a></li><li><a href="#tls-library-selection">TLS library selection</a></li></ul></nav><div class="content"><h3 id="core-types"><a href="#core-types" class="anchor"></a>Core types</h3><div><div class="spec type" id="type-client_tls_config" class="anchored"><a href="#type-client_tls_config" class="anchor"></a><code><span class="keyword">type</span> client_tls_config = <span>[ <span>`Hostname of string</span> ]</span> * <span>[ <span>`IP of <a href="../../ipaddr/Ipaddr/index.html#type-t">Ipaddr.t</a></span> ]</span> * <span>[ <span>`Port of int</span> ]</span></code></div><div><p>Configuration fragment for a TLS client connecting to a remote endpoint</p></div></div><div><div class="spec include"><div class="doc"><div class="spec value" id="val-sexp_of_client_tls_config" class="anchored"><a href="#val-sexp_of_client_tls_config" class="anchor"></a><code><span class="keyword">val</span> sexp_of_client_tls_config : <a href="index.html#type-client_tls_config">client_tls_config</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></div><div class="spec value" id="val-client_tls_config_of_sexp" class="anchored"><a href="#val-client_tls_config_of_sexp" class="anchor"></a><code><span class="keyword">val</span> client_tls_config_of_sexp : <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a> <span>&#45;&gt;</span> <a href="index.html#type-client_tls_config">client_tls_config</a></code></div></div></div></div><div><div class="spec type" id="type-client" class="anchored"><a href="#type-client" class="anchor"></a><code><span class="keyword">type</span> client = [ </code><table><tr id="type-client.TLS" class="anchored"><td class="def constructor"><a href="#type-client.TLS" class="anchor"></a><code>| </code><code>`TLS <span class="keyword">of</span> <a href="index.html#type-client_tls_config">client_tls_config</a></code></td></tr><tr id="type-client.TLS_native" class="anchored"><td class="def constructor"><a href="#type-client.TLS_native" class="anchor"></a><code>| </code><code>`TLS_native <span class="keyword">of</span> <a href="index.html#type-client_tls_config">client_tls_config</a></code></td><td class="doc"><p>Force use of native OCaml TLS stack to connect.</p></td></tr><tr id="type-client.OpenSSL" class="anchored"><td class="def constructor"><a href="#type-client.OpenSSL" class="anchor"></a><code>| </code><code>`OpenSSL <span class="keyword">of</span> <a href="index.html#type-client_tls_config">client_tls_config</a></code></td><td class="doc"><p>Force use of Lwt OpenSSL bindings to connect.</p></td></tr><tr id="type-client.TCP" class="anchored"><td class="def constructor"><a href="#type-client.TCP" class="anchor"></a><code>| </code><code>`TCP <span class="keyword">of</span> <span>[ <span>`IP of <a href="../../ipaddr/Ipaddr/index.html#type-t">Ipaddr.t</a></span> ]</span> * <span>[ <span>`Port of int</span> ]</span></code></td><td class="doc"><p>Use TCP to connect to the given <code>ip</code>, <code>port</code> tuple.</p></td></tr><tr id="type-client.Unix_domain_socket" class="anchored"><td class="def constructor"><a href="#type-client.Unix_domain_socket" class="anchor"></a><code>| </code><code>`Unix_domain_socket <span class="keyword">of</span> <span>[ <span>`File of string</span> ]</span></code></td><td class="doc"><p>Use UNIX domain sockets to connect to a socket on the <code>path</code>.</p></td></tr><tr id="type-client.Vchan_direct" class="anchored"><td class="def constructor"><a href="#type-client.Vchan_direct" class="anchor"></a><code>| </code><code>`Vchan_direct <span class="keyword">of</span> <span>[ <span>`Domid of int</span> ]</span> * <span>[ <span>`Port of string</span> ]</span></code></td><td class="doc"><p>Connect to the remote VM on the <code>domid</code>, <code>port</code> tuple.</p></td></tr><tr id="type-client.Vchan_domain_socket" class="anchored"><td class="def constructor"><a href="#type-client.Vchan_domain_socket" class="anchor"></a><code>| </code><code>`Vchan_domain_socket <span class="keyword">of</span> <span>[ <span>`Domain_name of string</span> ]</span> * <span>[ <span>`Port of string</span> ]</span></code></td><td class="doc"><p>Use the Vchan name resolution to connect</p></td></tr></table><code> ]</code></div><div><p>Set of supported client connections that are supported by this module:</p><ul><li><code>`TLS (`Hostname host, `IP ip, `Port port)</code>: Use OCaml-TLS or OpenSSL (depending on CONDUIT_TLS) to connect to the given <code>host</code>, <code>ip</code>, <code>port</code> tuple via TCP.</li><li><code>`TLS_native _</code>: Force use of native OCaml TLS stack to connect.</li><li><code>`OpenSSL _</code>: Force use of Lwt OpenSSL bindings to connect.</li><li><code>`TCP (`IP ip, `Port port)</code>: Use TCP to connect to the given <code>ip</code>, <code>port</code> tuple.</li><li><code>`Unix_domain_socket (`File path)</code>: Use UNIX domain sockets to connect to a socket on the <code>path</code>.</li><li><code>`Vchan_direct (`Domid domid, `Port port)</code>: Connect to the remote VM on the <code>domid</code>, <code>port</code> tuple.</li><li><code>`Vchan_domain_socket (`Domain_name domain, `Port port_name)</code>: Use the Vchan name resolution to connect.</li></ul></div></div><div><div class="spec include"><div class="doc"><div class="spec value" id="val-sexp_of_client" class="anchored"><a href="#val-sexp_of_client" class="anchor"></a><code><span class="keyword">val</span> sexp_of_client : <a href="index.html#type-client">client</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></div><div class="spec value" id="val-client_of_sexp" class="anchored"><a href="#val-client_of_sexp" class="anchor"></a><code><span class="keyword">val</span> client_of_sexp : <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a> <span>&#45;&gt;</span> <a href="index.html#type-client">client</a></code></div><div class="spec value" id="val-__client_of_sexp__" class="anchored"><a href="#val-__client_of_sexp__" class="anchor"></a><code><span class="keyword">val</span> __client_of_sexp__ : <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a> <span>&#45;&gt;</span> <a href="index.html#type-client">client</a></code></div></div></div></div><div><div class="spec type" id="type-server_tls_config" class="anchored"><a href="#type-server_tls_config" class="anchor"></a><code><span class="keyword">type</span> server_tls_config = <span>[ <span>`Crt_file_path of string</span> ]</span> * <span>[ <span>`Key_file_path of string</span> ]</span> * <span>[ <span>`Password of bool <span>&#45;&gt;</span> string</span> <span>| `No_password</span> ]</span> * <span>[ <span>`Port of int</span> ]</span></code></div><div><p>Configuration fragment for a listening TLS server</p></div></div><div><div class="spec include"><div class="doc"><div class="spec value" id="val-sexp_of_server_tls_config" class="anchored"><a href="#val-sexp_of_server_tls_config" class="anchor"></a><code><span class="keyword">val</span> sexp_of_server_tls_config : <a href="index.html#type-server_tls_config">server_tls_config</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></div><div class="spec value" id="val-server_tls_config_of_sexp" class="anchored"><a href="#val-server_tls_config_of_sexp" class="anchor"></a><code><span class="keyword">val</span> server_tls_config_of_sexp : <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a> <span>&#45;&gt;</span> <a href="index.html#type-server_tls_config">server_tls_config</a></code></div></div></div></div><div><div class="spec type" id="type-tcp_config" class="anchored"><a href="#type-tcp_config" class="anchor"></a><code><span class="keyword">type</span> tcp_config = [ </code><table><tr id="type-tcp_config.Port" class="anchored"><td class="def constructor"><a href="#type-tcp_config.Port" class="anchor"></a><code>| </code><code>`Port <span class="keyword">of</span> int</code></td></tr><tr id="type-tcp_config.Socket" class="anchored"><td class="def constructor"><a href="#type-tcp_config.Socket" class="anchor"></a><code>| </code><code>`Socket <span class="keyword">of</span> <a href="../../lwt/Lwt_unix/index.html#type-file_descr">Lwt_unix.file_descr</a></code></td></tr></table><code> ]</code></div><div><p>Set of ways to create TCP servers</p><ul><li><code>`Port port</code>: Create a socket listening to provided port.</li><li><code>`Socket file_descr</code>: Use the provided file descriptor to create a server.</li></ul></div></div><div><div class="spec include"><div class="doc"><div class="spec value" id="val-sexp_of_tcp_config" class="anchored"><a href="#val-sexp_of_tcp_config" class="anchor"></a><code><span class="keyword">val</span> sexp_of_tcp_config : <a href="index.html#type-tcp_config">tcp_config</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></div><div class="spec value" id="val-tcp_config_of_sexp" class="anchored"><a href="#val-tcp_config_of_sexp" class="anchor"></a><code><span class="keyword">val</span> tcp_config_of_sexp : <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a> <span>&#45;&gt;</span> <a href="index.html#type-tcp_config">tcp_config</a></code></div><div class="spec value" id="val-__tcp_config_of_sexp__" class="anchored"><a href="#val-__tcp_config_of_sexp__" class="anchor"></a><code><span class="keyword">val</span> __tcp_config_of_sexp__ : <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a> <span>&#45;&gt;</span> <a href="index.html#type-tcp_config">tcp_config</a></code></div></div></div></div><div><div class="spec type" id="type-server" class="anchored"><a href="#type-server" class="anchor"></a><code><span class="keyword">type</span> server = [ </code><table><tr id="type-server.TLS" class="anchored"><td class="def constructor"><a href="#type-server.TLS" class="anchor"></a><code>| </code><code>`TLS <span class="keyword">of</span> <a href="index.html#type-server_tls_config">server_tls_config</a></code></td></tr><tr id="type-server.OpenSSL" class="anchored"><td class="def constructor"><a href="#type-server.OpenSSL" class="anchor"></a><code>| </code><code>`OpenSSL <span class="keyword">of</span> <a href="index.html#type-server_tls_config">server_tls_config</a></code></td></tr><tr id="type-server.TLS_native" class="anchored"><td class="def constructor"><a href="#type-server.TLS_native" class="anchor"></a><code>| </code><code>`TLS_native <span class="keyword">of</span> <a href="index.html#type-server_tls_config">server_tls_config</a></code></td></tr><tr id="type-server.TCP" class="anchored"><td class="def constructor"><a href="#type-server.TCP" class="anchor"></a><code>| </code><code>`TCP <span class="keyword">of</span> <a href="index.html#type-tcp_config">tcp_config</a></code></td></tr><tr id="type-server.Unix_domain_socket" class="anchored"><td class="def constructor"><a href="#type-server.Unix_domain_socket" class="anchor"></a><code>| </code><code>`Unix_domain_socket <span class="keyword">of</span> <span>[ <span>`File of string</span> ]</span></code></td></tr><tr id="type-server.Vchan_direct" class="anchored"><td class="def constructor"><a href="#type-server.Vchan_direct" class="anchor"></a><code>| </code><code>`Vchan_direct <span class="keyword">of</span> int * string</code></td></tr><tr id="type-server.Vchan_domain_socket" class="anchored"><td class="def constructor"><a href="#type-server.Vchan_domain_socket" class="anchor"></a><code>| </code><code>`Vchan_domain_socket <span class="keyword">of</span> string * string</code></td></tr><tr id="type-server.Launchd" class="anchored"><td class="def constructor"><a href="#type-server.Launchd" class="anchor"></a><code>| </code><code>`Launchd <span class="keyword">of</span> string</code></td></tr></table><code> ]</code></div><div><p>Set of supported listening mechanisms that are supported by this module.</p><ul><li><code>`TLS server_tls_config</code>: Use OCaml-TLS or OpenSSL (depending on CONDUIT_TLS) to connect to the given <code>host</code>, <code>ip</code>, <code>port</code> tuple via TCP.</li><li><code>`TLS_native _</code>: Force use of native OCaml TLS stack to connect.</li><li><code>`OpenSSL _</code>: Force use of Lwt OpenSSL bindings to connect.</li><li><code>`TCP (`Port port)</code>: Listen on the specified TCPv4 port.</li><li><code>`Unix_domain_socket (`File path)</code>: Use UNIX domain sockets to listen on the path.</li><li><code>`Vchan_direct (domid, port)</code>: Listen for the remote VM on the <code>domid</code>, <code>port</code> tuple.</li><li><code>`Vchan_domain_socket (domain, port_name)</code>: Use the Vchan name resolution to listen</li><li><code>`Listening_socket fd</code>: Use the socket given, useful for inherited systemd sockets.</li><li><code>`Launchd name</code>: uses MacOS X launchd to start the service, via the name of the <code>Sockets</code> element within the service description plist file. See the <a href="http://mirage.github.io/ocaml-launchd/launchd/">ocaml-launchd</a> documentation for more.</li></ul></div></div><div><div class="spec include"><div class="doc"><div class="spec value" id="val-sexp_of_server" class="anchored"><a href="#val-sexp_of_server" class="anchor"></a><code><span class="keyword">val</span> sexp_of_server : <a href="index.html#type-server">server</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></div><div class="spec value" id="val-server_of_sexp" class="anchored"><a href="#val-server_of_sexp" class="anchor"></a><code><span class="keyword">val</span> server_of_sexp : <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a> <span>&#45;&gt;</span> <a href="index.html#type-server">server</a></code></div><div class="spec value" id="val-__server_of_sexp__" class="anchored"><a href="#val-__server_of_sexp__" class="anchor"></a><code><span class="keyword">val</span> __server_of_sexp__ : <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a> <span>&#45;&gt;</span> <a href="index.html#type-server">server</a></code></div></div></div></div><div class="spec type" id="type-io" class="anchored"><a href="#type-io" class="anchor"></a><code><span class="keyword">type</span> <span>'a io</span> = <span><span class="type-var">'a</span> <a href="../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div class="spec type" id="type-ic" class="anchored"><a href="#type-ic" class="anchor"></a><code><span class="keyword">type</span> ic = <a href="../../lwt/Lwt_io/index.html#type-input_channel">Lwt_io.input_channel</a></code></div><div class="spec type" id="type-oc" class="anchored"><a href="#type-oc" class="anchor"></a><code><span class="keyword">type</span> oc = <a href="../../lwt/Lwt_io/index.html#type-output_channel">Lwt_io.output_channel</a></code></div><div><div class="spec type" id="type-tcp_flow" class="anchored"><a href="#type-tcp_flow" class="anchor"></a><code><span class="keyword">type</span> tcp_flow = <span class="keyword">private</span> {</code><table><tr id="type-tcp_flow.fd" class="anchored"><td class="def record field"><a href="#type-tcp_flow.fd" class="anchor"></a><code>fd : <a href="../../lwt/Lwt_unix/index.html#type-file_descr">Lwt_unix.file_descr</a>;</code></td></tr><tr id="type-tcp_flow.ip" class="anchored"><td class="def record field"><a href="#type-tcp_flow.ip" class="anchor"></a><code>ip : <a href="../../ipaddr/Ipaddr/index.html#type-t">Ipaddr.t</a>;</code></td></tr><tr id="type-tcp_flow.port" class="anchored"><td class="def record field"><a href="#type-tcp_flow.port" class="anchor"></a><code>port : int;</code></td></tr></table><code>}</code></div><div><p><code>tcp_flow</code> contains the state of a single TCP connection.</p></div></div><div><div class="spec include"><div class="doc"><div class="spec value" id="val-sexp_of_tcp_flow" class="anchored"><a href="#val-sexp_of_tcp_flow" class="anchor"></a><code><span class="keyword">val</span> sexp_of_tcp_flow : <a href="index.html#type-tcp_flow">tcp_flow</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></div></div></div></div><div><div class="spec type" id="type-domain_flow" class="anchored"><a href="#type-domain_flow" class="anchor"></a><code><span class="keyword">type</span> domain_flow = <span class="keyword">private</span> {</code><table><tr id="type-domain_flow.fd" class="anchored"><td class="def record field"><a href="#type-domain_flow.fd" class="anchor"></a><code>fd : <a href="../../lwt/Lwt_unix/index.html#type-file_descr">Lwt_unix.file_descr</a>;</code></td></tr><tr id="type-domain_flow.path" class="anchored"><td class="def record field"><a href="#type-domain_flow.path" class="anchor"></a><code>path : string;</code></td></tr></table><code>}</code></div><div><p><code>domain_flow</code> contains the state of a single Unix domain socket connection.</p></div></div><div><div class="spec include"><div class="doc"><div class="spec value" id="val-sexp_of_domain_flow" class="anchored"><a href="#val-sexp_of_domain_flow" class="anchor"></a><code><span class="keyword">val</span> sexp_of_domain_flow : <a href="index.html#type-domain_flow">domain_flow</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></div></div></div></div><div><div class="spec type" id="type-vchan_flow" class="anchored"><a href="#type-vchan_flow" class="anchor"></a><code><span class="keyword">type</span> vchan_flow = <span class="keyword">private</span> {</code><table><tr id="type-vchan_flow.domid" class="anchored"><td class="def record field"><a href="#type-vchan_flow.domid" class="anchor"></a><code>domid : int;</code></td></tr><tr id="type-vchan_flow.port" class="anchored"><td class="def record field"><a href="#type-vchan_flow.port" class="anchor"></a><code>port : string;</code></td></tr></table><code>}</code></div><div><p><code>vchan_flow</code> contains the state of a single Vchan shared memory connection.</p></div></div><div><div class="spec include"><div class="doc"><div class="spec value" id="val-sexp_of_vchan_flow" class="anchored"><a href="#val-sexp_of_vchan_flow" class="anchor"></a><code><span class="keyword">val</span> sexp_of_vchan_flow : <a href="index.html#type-vchan_flow">vchan_flow</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></div></div></div></div><div><div class="spec type" id="type-flow" class="anchored"><a href="#type-flow" class="anchor"></a><code><span class="keyword">type</span> flow = <span class="keyword">private</span> </code><table><tr id="type-flow.TCP" class="anchored"><td class="def variant constructor"><a href="#type-flow.TCP" class="anchor"></a><code>| <span class="constructor">TCP</span> <span class="keyword">of</span> <a href="index.html#type-tcp_flow">tcp_flow</a></code></td></tr><tr id="type-flow.Domain_socket" class="anchored"><td class="def variant constructor"><a href="#type-flow.Domain_socket" class="anchor"></a><code>| <span class="constructor">Domain_socket</span> <span class="keyword">of</span> <a href="index.html#type-domain_flow">domain_flow</a></code></td></tr><tr id="type-flow.Vchan" class="anchored"><td class="def variant constructor"><a href="#type-flow.Vchan" class="anchor"></a><code>| <span class="constructor">Vchan</span> <span class="keyword">of</span> <a href="index.html#type-vchan_flow">vchan_flow</a></code></td></tr></table></div><div><p>A <code>flow</code> contains the state of a single connection, over a specific transport method.</p></div></div><div><div class="spec include"><div class="doc"><div class="spec value" id="val-sexp_of_flow" class="anchored"><a href="#val-sexp_of_flow" class="anchor"></a><code><span class="keyword">val</span> sexp_of_flow : <a href="index.html#type-flow">flow</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></div></div></div></div><div><div class="spec type" id="type-tls_own_key" class="anchored"><a href="#type-tls_own_key" class="anchor"></a><code><span class="keyword">type</span> tls_own_key = [ </code><table><tr id="type-tls_own_key.None" class="anchored"><td class="def constructor"><a href="#type-tls_own_key.None" class="anchor"></a><code>| </code><code>`None</code></td></tr><tr id="type-tls_own_key.TLS" class="anchored"><td class="def constructor"><a href="#type-tls_own_key.TLS" class="anchor"></a><code>| </code><code>`TLS <span class="keyword">of</span> <span>[ <span>`Crt_file_path of string</span> ]</span> * <span>[ <span>`Key_file_path of string</span> ]</span> * <span>[ <span>`Password of bool <span>&#45;&gt;</span> string</span> <span>| `No_password</span> ]</span></code></td></tr></table><code> ]</code></div><div><p>Type describing where to locate a PEM key in the filesystem</p></div></div><div><div class="spec include"><div class="doc"><div class="spec value" id="val-sexp_of_tls_own_key" class="anchored"><a href="#val-sexp_of_tls_own_key" class="anchor"></a><code><span class="keyword">val</span> sexp_of_tls_own_key : <a href="index.html#type-tls_own_key">tls_own_key</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></div><div class="spec value" id="val-tls_own_key_of_sexp" class="anchored"><a href="#val-tls_own_key_of_sexp" class="anchor"></a><code><span class="keyword">val</span> tls_own_key_of_sexp : <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a> <span>&#45;&gt;</span> <a href="index.html#type-tls_own_key">tls_own_key</a></code></div><div class="spec value" id="val-__tls_own_key_of_sexp__" class="anchored"><a href="#val-__tls_own_key_of_sexp__" class="anchor"></a><code><span class="keyword">val</span> __tls_own_key_of_sexp__ : <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a> <span>&#45;&gt;</span> <a href="index.html#type-tls_own_key">tls_own_key</a></code></div></div></div></div><div><div class="spec type" id="type-ctx" class="anchored"><a href="#type-ctx" class="anchor"></a><code><span class="keyword">type</span> ctx</code></div><div><p>State handler for an active conduit</p></div></div><div><div class="spec include"><div class="doc"><div class="spec value" id="val-sexp_of_ctx" class="anchored"><a href="#val-sexp_of_ctx" class="anchor"></a><code><span class="keyword">val</span> sexp_of_ctx : <a href="index.html#type-ctx">ctx</a> <span>&#45;&gt;</span> <a href="../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></div></div></div></div><h3 id="connection-and-listening"><a href="#connection-and-listening" class="anchor"></a>Connection and listening</h3><div><div class="spec value" id="val-default_ctx" class="anchored"><a href="#val-default_ctx" class="anchor"></a><code><span class="keyword">val</span> default_ctx : <a href="index.html#type-ctx">ctx</a></code></div><div><p>Default context that listens on all source addresses with no TLS certificate associated with the Conduit</p></div></div><div><div class="spec value" id="val-init" class="anchored"><a href="#val-init" class="anchor"></a><code><span class="keyword">val</span> init : <span>?&#8288;src:string</span> <span>&#45;&gt;</span> <span>?&#8288;tls_own_key:<a href="index.html#type-tls_own_key">tls_own_key</a></span> <span>&#45;&gt;</span> <span>?&#8288;tls_server_key:<a href="index.html#type-tls_own_key">tls_own_key</a></span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span><a href="index.html#type-ctx">ctx</a> <a href="index.html#type-io">io</a></span></code></div><div><p><code>init ?src ?tls_own_key ()</code> will initialize a Unix conduit that binds to the <code>src</code> interface if specified. If TLS server connections are used, then <code>tls_server_key</code> must contain a valid certificate to be used to advertise a TLS connection</p></div></div><div><div class="spec value" id="val-connect" class="anchored"><a href="#val-connect" class="anchor"></a><code><span class="keyword">val</span> connect : <span>ctx:<a href="index.html#type-ctx">ctx</a></span> <span>&#45;&gt;</span> <a href="index.html#type-client">client</a> <span>&#45;&gt;</span> <span><span>(<a href="index.html#type-flow">flow</a> * <a href="index.html#type-ic">ic</a> * <a href="index.html#type-oc">oc</a>)</span> <a href="index.html#type-io">io</a></span></code></div><div><p><code>connect ~ctx client</code> establishes an outgoing connection via the <code>ctx</code> context to the endpoint described by <code>client</code></p></div></div><div><div class="spec value" id="val-serve" class="anchored"><a href="#val-serve" class="anchor"></a><code><span class="keyword">val</span> serve : <span>?&#8288;backlog:int</span> <span>&#45;&gt;</span> <span>?&#8288;timeout:int</span> <span>&#45;&gt;</span> <span>?&#8288;stop:<span>unit <a href="index.html#type-io">io</a></span></span> <span>&#45;&gt;</span> <span>on_exn:<span>(exn <span>&#45;&gt;</span> unit)</span></span> <span>&#45;&gt;</span> <span>ctx:<a href="index.html#type-ctx">ctx</a></span> <span>&#45;&gt;</span> <span>mode:<a href="index.html#type-server">server</a></span> <span>&#45;&gt;</span> <span>(<a href="index.html#type-flow">flow</a> <span>&#45;&gt;</span> <a href="index.html#type-ic">ic</a> <span>&#45;&gt;</span> <a href="index.html#type-oc">oc</a> <span>&#45;&gt;</span> <span>unit <a href="index.html#type-io">io</a></span>)</span> <span>&#45;&gt;</span> <span>unit <a href="index.html#type-io">io</a></span></code></div><div><p><code>serve ?backlog ?timeout ?stop ~on_exn ~ctx ~mode fn</code> establishes a listening connection of type <code>mode</code>, using the <code>ctx</code> context. The <code>stop</code> thread will terminate the server if it ever becomes determined. Every connection will be served in a new lightweight thread that is invoked via the <code>fn</code> callback. The <code>fn</code> callback is passed the <a href="index.html#type-flow"><code>flow</code></a> representing the client connection and the associated input <a href="index.html#type-ic"><code>ic</code></a> and output <a href="index.html#type-oc"><code>oc</code></a> channels. If the callback raises an exception, it is passed to <code>on_exn</code>.</p></div></div><div><div class="spec value" id="val-set_max_active" class="anchored"><a href="#val-set_max_active" class="anchor"></a><code><span class="keyword">val</span> set_max_active : int <span>&#45;&gt;</span> unit</code></div><div><p><code>set_max_active nconn</code> sets the maximum number of active connections accepted. When the limit is hit accept blocks until another server connection is closed.</p></div></div><div><div class="spec value" id="val-endp_of_flow" class="anchored"><a href="#val-endp_of_flow" class="anchor"></a><code><span class="keyword">val</span> endp_of_flow : <a href="index.html#type-flow">flow</a> <span>&#45;&gt;</span> <a href="../../conduit/Conduit/index.html#type-endp">Conduit.endp</a></code></div><div><p><code>endp_of_flow flow</code> retrieves the original <a href="../../conduit/Conduit/index.html#type-endp"><code>Conduit.endp</code></a> from the established <code>flow</code></p></div></div><div><div class="spec value" id="val-endp_to_client" class="anchored"><a href="#val-endp_to_client" class="anchor"></a><code><span class="keyword">val</span> endp_to_client : <span>ctx:<a href="index.html#type-ctx">ctx</a></span> <span>&#45;&gt;</span> <a href="../../conduit/Conduit/index.html#type-endp">Conduit.endp</a> <span>&#45;&gt;</span> <span><a href="index.html#type-client">client</a> <a href="index.html#type-io">io</a></span></code></div><div><p><code>endp_to_client ~ctx endp</code> converts an <code>endp</code> into a a concrete connection mechanism of type <code>client</code></p></div></div><div><div class="spec value" id="val-endp_to_server" class="anchored"><a href="#val-endp_to_server" class="anchor"></a><code><span class="keyword">val</span> endp_to_server : <span>ctx:<a href="index.html#type-ctx">ctx</a></span> <span>&#45;&gt;</span> <a href="../../conduit/Conduit/index.html#type-endp">Conduit.endp</a> <span>&#45;&gt;</span> <span><a href="index.html#type-server">server</a> <a href="index.html#type-io">io</a></span></code></div><div><p><code>endp_to_server ~ctx endp</code> converts an <code>endp</code> into a a concrete connection mechanism of type <code>server</code></p></div></div><h3 id="tls-library-selection"><a href="#tls-library-selection" class="anchor"></a>TLS library selection</h3><div><div class="spec type" id="type-tls_lib" class="anchored"><a href="#type-tls_lib" class="anchor"></a><code><span class="keyword">type</span> tls_lib = </code><table><tr id="type-tls_lib.OpenSSL" class="anchored"><td class="def variant constructor"><a href="#type-tls_lib.OpenSSL" class="anchor"></a><code>| <span class="constructor">OpenSSL</span></code></td><td class="doc"><p>The <code>Lwt_ssl</code> bindings to the C OpenSSL library</p></td></tr><tr id="type-tls_lib.Native" class="anchored"><td class="def variant constructor"><a href="#type-tls_lib.Native" class="anchor"></a><code>| <span class="constructor">Native</span></code></td><td class="doc"><p>A pure OCaml TLS implementation</p></td></tr><tr id="type-tls_lib.No_tls" class="anchored"><td class="def variant constructor"><a href="#type-tls_lib.No_tls" class="anchor"></a><code>| <span class="constructor">No_tls</span></code></td><td class="doc"><p>No TLS implementation available, so any connections will fail</p></td></tr></table></div><div><p>Currently selected method of using TLS for client and servers</p></div></div><div><div class="spec value" id="val-tls_library" class="anchored"><a href="#val-tls_library" class="anchor"></a><code><span class="keyword">val</span> tls_library : <span><a href="index.html#type-tls_lib">tls_lib</a> <a href="../../ocaml/Stdlib/index.html#type-ref">Stdlib.ref</a></span></code></div><div><p>The default selection is to select <a href="index.html#type-tls_lib.OpenSSL"><code>OpenSSL</code></a>, <a href="index.html#type-tls_lib.Native"><code>Native</code></a> and <a href="index.html#type-tls_lib.No_tls"><code>No_tls</code></a> in decreasing order of priority. The native OCaml stack can be forced by setting the <code>CONDUIT_TLS</code> Unix environment variable to <code>native</code>.</p></div></div></div></body></html>