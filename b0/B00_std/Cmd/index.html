<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Cmd (b0.B00_std.Cmd)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> – <a href="../../index.html">b0</a> &#x00BB; <a href="../index.html">B00_std</a> &#x00BB; Cmd</nav><header><h1>Module <code>B00_std.Cmd</code></h1><p>Command lines.</p><p>Command line values specify the command line arguments given to tools spawns. In certain contexts the command line value is the full specification of the tool spawn, in this case the first element of the line defines the program to invoke. In other contexts the tool to invoke and its arguments are kept separate.</p><p><code>examples</code>.</p><p><b>B00 artefact.</b> This module allows to <code>unstamp</code> command arguments. Unstamped arguments have no special semantics as far as the command line is concerned they simply indicate that the argument value itself does not influence the outputs of the tool. Unstamped arguments do not appear in the command line <span class="xref-unresolved">stamp</span> which is used to memoize tool spawns. A typical example of unstamped arguments are file paths to inputs: it's often the file contents not the actual file path that determines the tool output; beware though that some tool use both the file path contents and the actual file path in their outputs.</p></header><nav class="toc"><ul><li><a href="#cl">Command lines</a></li><li><a href="#derived">Derived combinators</a></li><li><a href="#tool">Tools</a></li><li><a href="#preds">Predicates</a></li><li><a href="#converting">Converting</a></li><li><a href="#examples">Examples</a></li></ul></nav><div class="content"><h2 id="cl"><a href="#cl" class="anchor"></a>Command lines</h2><div><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></div><div><p>The type for command lines. A command line is a list of command line arguments.</p></div></div><div><div class="spec value" id="val-is_empty" class="anchored"><a href="#val-is_empty" class="anchor"></a><code><span class="keyword">val</span> is_empty : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></div><div><p><code>is_empty l</code> is <code>true</code> iff <code>l</code> is an empty list of arguments.</p></div></div><div><div class="spec value" id="val-empty" class="anchored"><a href="#val-empty" class="anchor"></a><code><span class="keyword">val</span> empty : <a href="index.html#type-t">t</a></code></div><div><p><code>empty</code> is an empty list of arguments.</p></div></div><div><div class="spec value" id="val-arg" class="anchored"><a href="#val-arg" class="anchor"></a><code><span class="keyword">val</span> arg : string <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>arg a</code> is the argument <code>a</code>.</p></div></div><div><div class="spec value" id="val-append" class="anchored"><a href="#val-append" class="anchor"></a><code><span class="keyword">val</span> append : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>append l1 l2</code> appends arguments <code>l2</code> to <code>l1</code>.</p></div></div><div><div class="spec value" id="val-unstamp" class="anchored"><a href="#val-unstamp" class="anchor"></a><code><span class="keyword">val</span> unstamp : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>unstamp l</code> indicates that arguments <code>l</code> do not influence the tool's invocation outputs. These arguments are omitted from the command line's <a href="index.html#val-to_list_and_stamp">stamp</a>.</p></div></div><h2 id="derived"><a href="#derived" class="anchor"></a>Derived combinators</h2><div><div class="spec value" id="val-(%)" class="anchored"><a href="#val-(%)" class="anchor"></a><code><span class="keyword">val</span> (%) : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>l % a</code> is <code>append l (arg a)</code>.</p></div></div><div><div class="spec value" id="val-(%%)" class="anchored"><a href="#val-(%%)" class="anchor"></a><code><span class="keyword">val</span> (%%) : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>l1 % l2</code> is <code>append l1 l2</code>.</p></div></div><div><div class="spec value" id="val-if'" class="anchored"><a href="#val-if'" class="anchor"></a><code><span class="keyword">val</span> if' : bool <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>if' cond l</code> is <code>l</code> if <code>cond</code> is <code>true</code> and <a href="index.html#val-empty"><code>empty</code></a> otherwise.</p></div></div><div><div class="spec value" id="val-path" class="anchored"><a href="#val-path" class="anchor"></a><code><span class="keyword">val</span> path : <a href="../Fpath/index.html#type-t">Fpath.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>path p</code> is <code>arg (Fpath.to_string p)</code>.</p></div></div><div><div class="spec value" id="val-args" class="anchored"><a href="#val-args" class="anchor"></a><code><span class="keyword">val</span> args : <span>?&#8288;slip:string</span> <span>&#45;&gt;</span> <span>string list</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>args ?slip l</code> is a command line from the list of arguments <code>l</code>. If <code>slip</code> is specified it is added on the command line before each element of <code>l</code>.</p></div></div><div><div class="spec value" id="val-rev_args" class="anchored"><a href="#val-rev_args" class="anchor"></a><code><span class="keyword">val</span> rev_args : <span>?&#8288;slip:string</span> <span>&#45;&gt;</span> <span>string list</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>rev_args ?slip l</code> is <a href="index.html#val-args"><code>args</code></a><code> ?slip (List.rev l)</code>.</p></div></div><div><div class="spec value" id="val-of_list" class="anchored"><a href="#val-of_list" class="anchor"></a><code><span class="keyword">val</span> of_list : <span>?&#8288;slip:string</span> <span>&#45;&gt;</span> <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> string)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> list</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>of_list ?slip conv l</code> is <a href="index.html#val-args"><code>args</code></a><code> ?slip (List.map conv l)</code>.</p></div></div><div><div class="spec value" id="val-of_rev_list" class="anchored"><a href="#val-of_rev_list" class="anchor"></a><code><span class="keyword">val</span> of_rev_list : <span>?&#8288;slip:string</span> <span>&#45;&gt;</span> <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> string)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> list</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>of_rev_list ?slip conv l</code> is <a href="index.html#val-args"><code>args</code></a><code> ?slip (List.rev_map conv l)</code>.</p></div></div><div><div class="spec value" id="val-paths" class="anchored"><a href="#val-paths" class="anchor"></a><code><span class="keyword">val</span> paths : <span>?&#8288;slip:string</span> <span>&#45;&gt;</span> <span><a href="../Fpath/index.html#type-t">Fpath.t</a> list</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>paths ?slip ps</code> is <a href="index.html#val-of_list"><code>of_list</code></a><code> ?slip Fpath.to_string ps</code>.</p></div></div><div><div class="spec value" id="val-rev_paths" class="anchored"><a href="#val-rev_paths" class="anchor"></a><code><span class="keyword">val</span> rev_paths : <span>?&#8288;slip:string</span> <span>&#45;&gt;</span> <span><a href="../Fpath/index.html#type-t">Fpath.t</a> list</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>rev_paths ?slip ps</code> is <a href="index.html#val-of_rev_list"><code>of_rev_list</code></a><code> ?slip Fpath.to_string ps</code>.</p></div></div><h2 id="tool"><a href="#tool" class="anchor"></a>Tools</h2><div><div class="spec type" id="type-tool" class="anchored"><a href="#type-tool" class="anchor"></a><code><span class="keyword">type</span> tool = <a href="../Fpath/index.html#type-t">Fpath.t</a></code></div><div><p>The type for command line tools. A command line tool is represented by a file path according to the POSIX convention for <code>exec(3)</code>. If it is made of a single segment, for example <code>Fpath.v &quot;ocaml&quot;</code>, it represents a program name to be looked up via a search procedure; for example in the <code>PATH</code> environment variable. If it is a file path with multiple segments (POSIX would say if they contain a slash characters) the program is the file itself.</p></div></div><div><div class="spec value" id="val-tool" class="anchored"><a href="#val-tool" class="anchor"></a><code><span class="keyword">val</span> tool : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-tool">tool</a> option</span></code></div><div><p><code>tool l</code> is <code>l</code>'s first element. This is <code>None</code> if the line is <a href="index.html#val-empty"><code>empty</code></a> or if the first element can't be parsed to a <a href="index.html#val-tool"><code>tool</code></a>.</p></div></div><div><div class="spec value" id="val-set_tool" class="anchored"><a href="#val-set_tool" class="anchor"></a><code><span class="keyword">val</span> set_tool : <a href="index.html#type-tool">tool</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> option</span></code></div><div><p><code>set_tool tool l</code> replaces <code>l</code>'s first element with <code>tool</code>. This is <code>None</code> if <code>l</code> is <a href="index.html#val-empty"><code>empty</code></a>.</p></div></div><div><div class="spec value" id="val-get_tool" class="anchored"><a href="#val-get_tool" class="anchor"></a><code><span class="keyword">val</span> get_tool : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-tool">tool</a></code></div><div><p><code>get_tool</code> is like <a href="index.html#val-tool"><code>tool</code></a> but raises <code>Invalid_argument</code> in case of error.</p></div></div><div><div class="spec value" id="val-pp_tool" class="anchored"><a href="#val-pp_tool" class="anchor"></a><code><span class="keyword">val</span> pp_tool : <span><a href="index.html#type-tool">tool</a> <a href="../Fmt/index.html#type-t">Fmt.t</a></span></code></div><div><p><code>pp_tool</code> formats a tool for the TTY.</p></div></div><h2 id="preds"><a href="#preds" class="anchor"></a>Predicates</h2><div><div class="spec value" id="val-is_singleton" class="anchored"><a href="#val-is_singleton" class="anchor"></a><code><span class="keyword">val</span> is_singleton : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></div><div><p><code>is_singleton l</code> is <code>true</code> iff <code>l</code> has a single argument.</p></div></div><h2 id="converting"><a href="#converting" class="anchor"></a>Converting</h2><div><div class="spec value" id="val-fold" class="anchored"><a href="#val-fold" class="anchor"></a><code><span class="keyword">val</span> fold : <span>arg:<span>(string <span>&#45;&gt;</span> <span class="type-var">'a</span>)</span></span> <span>&#45;&gt;</span> <span>unstamp:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>)</span></span> <span>&#45;&gt;</span> <span>append:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>)</span></span> <span>&#45;&gt;</span> <span>empty:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></div><div><p><code>fold ~arg ~unstamp ~append ~empty l</code> folds over <code>l</code>'s structure.</p></div></div><div class="spec value" id="val-iter_enc" class="anchored"><a href="#val-iter_enc" class="anchor"></a><code><span class="keyword">val</span> iter_enc : <span>arg:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit)</span></span> <span>&#45;&gt;</span> <span>unstamp:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> unit)</span></span> <span>&#45;&gt;</span> <span>append:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> unit)</span></span> <span>&#45;&gt;</span> <span>empty:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> unit)</span></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><div class="spec value" id="val-to_list" class="anchored"><a href="#val-to_list" class="anchor"></a><code><span class="keyword">val</span> to_list : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>string list</span></code></div><div><p><code>to_list l</code> converts <code>l</code> to a list of strings.</p></div></div><div><div class="spec value" id="val-to_stamp" class="anchored"><a href="#val-to_stamp" class="anchor"></a><code><span class="keyword">val</span> to_stamp : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>string list</span></code></div><div><p><code>to_stamp l</code> is the sequence of stamped arguments.</p></div></div><div><div class="spec value" id="val-to_list_and_stamp" class="anchored"><a href="#val-to_list_and_stamp" class="anchor"></a><code><span class="keyword">val</span> to_list_and_stamp : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>string list</span> * <span>string list</span></code></div><div><p><code>to_list_and_stamp l</code> is a <code>l</code> as a list of strings tuppled with its stamp: the sequence of stamped arguments.</p></div></div><div><div class="spec value" id="val-to_string" class="anchored"><a href="#val-to_string" class="anchor"></a><code><span class="keyword">val</span> to_string : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></div><div><p><code>to_string l</code> converts <code>l</code> to a string that can be passed to the <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/system.html"><code>command(3)</code></a> POSIX system call.</p></div></div><div><div class="spec value" id="val-of_string" class="anchored"><a href="#val-of_string" class="anchor"></a><code><span class="keyword">val</span> of_string : string <span>&#45;&gt;</span> <span><span>(<a href="index.html#type-t">t</a>, string)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span></code></div><div><p><code>of_string s</code> tokenizes <code>s</code> into a command line. The tokens are recognized according to the <code>token</code> production of the following grammar which should be mostly be compatible with POSIX shell tokenization.</p><pre>white   ::= ' ' | '\t' | '\n' | '\x0B' | '\x0C' | '\r'
squot   ::= '\''
dquot   ::= '\&quot;'
bslash  ::= '\\'
tokens  ::= white+ tokens | token tokens | ϵ
token   ::= ([^squot dquot white] | squoted | dquoted) token | ϵ
squoted ::= squot [^squot]* squot
dquoted ::= dquot (qchar | [^dquot])* dquot
qchar   ::= bslash (bslash | dquot | '$' | '`' | '\n')</pre><p><code>qchar</code> are substitued by the byte they escape except for <code>'\n'</code> which removes the backslash and newline from the byte stream. <code>squoted</code> and <code>dquoted</code> represent the bytes they enclose.</p></div></div><div><div class="spec value" id="val-pp" class="anchored"><a href="#val-pp" class="anchor"></a><code><span class="keyword">val</span> pp : <span><a href="index.html#type-t">t</a> <a href="../Fmt/index.html#type-t">Fmt.t</a></span></code></div><div><p><code>pp ppf l</code> formats an unspecified representation of <code>l</code> on <code>ppf</code>.</p></div></div><div><div class="spec value" id="val-pp_dump" class="anchored"><a href="#val-pp_dump" class="anchor"></a><code><span class="keyword">val</span> pp_dump : <span><a href="index.html#type-t">t</a> <a href="../Fmt/index.html#type-t">Fmt.t</a></span></code></div><div><p><code>pp_dump ppf l</code> dumps and unspecified representation of <code>l</code> on <code>ppf</code>.</p></div></div><h2 id="examples"><a href="#examples" class="anchor"></a>Examples</h2><aside><pre><code>let ls p = Cmd.(arg &quot;ls&quot; % &quot;-a&quot; % path p)
let tar archive dir =
  Cmd.(arg &quot;tar&quot; % &quot;-cvf&quot; %% unstamp (path archive) %% path dir)

let opam cmd = Cmd.(arg &quot;opam&quot; % cmd)
let opam_install pkgs = Cmd.(opam &quot;install&quot; %% args pkgs)

let ocamlc ?(debug = false) file =
  Cmd.(arg &quot;ocamlc&quot; % &quot;-c&quot; % if' debug (arg &quot;-g&quot;) %% path file)

let ocamlopt ?(profile = false) ?(debug = false) incs file =
  let profile = Cmd.(if' profile (arg &quot;-p&quot;)) in
  let debug = Cmd.(if' debug (arg &quot;-g&quot;)) in
  let incs = Cmd.(unstamp (paths ~slip:&quot;-I&quot; incs)) in
  Cmd.(arg &quot;ocamlopt&quot; % &quot;-c&quot; %% debug %% profile %% incs %% unstamp (path file))</code></pre></aside></div></body></html>