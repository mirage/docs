<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>B0_srcs (b0.B0_srcs)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> – <a href="../index.html">b0</a> &#x00BB; B0_srcs</nav><header><h1>Module <code>B0_srcs</code></h1><p>Select source files.</p><p>This module provides a type to select source files for build units in B0 files. To support generated source files, selections can depend on the build.</p><p>In a nutshell the declaration:</p><pre><code>let srcs = [ `D &quot;src-exe&quot;; `D_rec &quot;src&quot;; `X &quot;src/not.ml&quot;; `X &quot;src/not&quot;]</code></pre><p>instructs to:</p><ul><li>Select all the files in directory <code>src-exe</code>.</li><li>Select all the files in the file hierarchy rooted at directory <code>src</code>.</li><li>Remove from the files found in directories the files whose paths segments are prefixed by <code>src/not.ml</code> and <code>src/not</code>.</li></ul><p>The prefix relation for exclusions respects path segments boundaries. In the example any file whose path matches <code>src/not.ml</code>, <code>src/not.ml/*</code>, <code>src/not</code> and <code>src/not/*</code> is excluded from the selection. But for example <code>src/not.c</code> is not.</p><p>The relative order of directory selections and exclusions doesn't matter, the semantics is to select all the files via <code>`D</code> and <code>`D_rec</code> and then apply the exclusion <code>`X</code> on the resulting set. Exclusions affect only directory selections, not file <code>`F</code> and fiber <code>`Fiber</code> <span class="xref-unresolved">selections</span>.</p><p>When a directory is selected via <code>`D</code> or <code>`D_rec</code>, all its files are, modulo exclusions. It is expected that build units themselves filter the final result by file extension or additional mechanisms. Consult the documentation of build units for more information.</p></header><nav class="toc"><ul><li><a href="#sel">Source selection</a></li></ul></nav><div class="content"><h2 id="sel"><a href="#sel" class="anchor"></a>Source selection</h2><div><div class="spec type" id="type-fpath" class="anchored"><a href="#type-fpath" class="anchor"></a><code><span class="keyword">type</span> fpath = string</code></div><div><p>The type for file paths. Must be convertible with <a href="../B00_std/Fpath/index.html#val-of_string"><code>B00_std.Fpath.of_string</code></a>. We do not use <a href="../B00_std/Fpath/index.html"><code>B00_std.Fpath</code></a> directly to allow for a lighter syntax in B0 files.</p><p><b>Important.</b> Use only <code>&quot;/&quot;</code> as the directory separator even on Windows® platforms. Don't be upset the UI gives them back to you using the local platform separator.</p></div></div><div><div class="spec value" id="val-fpath" class="anchored"><a href="#val-fpath" class="anchor"></a><code><span class="keyword">val</span> fpath : <a href="../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> <span>&#45;&gt;</span> <a href="index.html#type-fpath">fpath</a></code></div><div><p><code>fpath</code> is <a href="../B00_std/Fpath/index.html#val-to_string"><code>B00_std.Fpath.to_string</code></a>. If you prefer to specify your paths the clean way. TODO remove ?</p></div></div><div><div class="spec type" id="type-sel" class="anchored"><a href="#type-sel" class="anchor"></a><code><span class="keyword">type</span> sel = [ </code><table><tr id="type-sel.D" class="anchored"><td class="def constructor"><a href="#type-sel.D" class="anchor"></a><code>| </code><code>`D <span class="keyword">of</span> <a href="index.html#type-fpath">fpath</a></code></td></tr><tr id="type-sel.D_rec" class="anchored"><td class="def constructor"><a href="#type-sel.D_rec" class="anchor"></a><code>| </code><code>`D_rec <span class="keyword">of</span> <a href="index.html#type-fpath">fpath</a></code></td></tr><tr id="type-sel.X" class="anchored"><td class="def constructor"><a href="#type-sel.X" class="anchor"></a><code>| </code><code>`X <span class="keyword">of</span> <a href="index.html#type-fpath">fpath</a></code></td></tr><tr id="type-sel.F" class="anchored"><td class="def constructor"><a href="#type-sel.F" class="anchor"></a><code>| </code><code>`F <span class="keyword">of</span> <a href="index.html#type-fpath">fpath</a></code></td></tr><tr id="type-sel.Fiber" class="anchored"><td class="def constructor"><a href="#type-sel.Fiber" class="anchor"></a><code>| </code><code>`Fiber <span class="keyword">of</span> <a href="../B0_build/index.html#type-t">B0_build.t</a> <span>&#45;&gt;</span> <span><a href="../B00_std/Fpath/Set/index.html#type-t">B00_std.Fpath.Set.t</a> <a href="../B00/Memo/index.html#type-fiber">B00.Memo.fiber</a></span></code></td></tr></table><code> ]</code></div><div><p>The type for file selectors.</p><ul><li><code>`F f</code> unconditionaly selects the file <code>f</code>. <code>f</code> must exist and be a file.</li><li><code>`D d</code> selects the files of directory <code>d</code> modulo <code>`X</code> exclusions. <code>d</code> must exist and be a directory. dotfile paths are ignored.</li><li><code>`D_rec d</code> selects the files of the file <em>hierarchy</em> rooted at <code>d</code> modulo <code>`X</code> exclusions. <code>d</code> must exist and be a directory. dotfile paths are ignored.</li><li><code>`X x</code> removes from directory selections any file whose path segments are prefixed by <code>x</code>, respecting segment boundaries. A potential trailing directory separators in <code>x</code> is removed.</li><li><code>`Fiber f</code> uses the given fiber during the build to determine a set of files unconditionally added to the selection.</li></ul></div></div><div><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t = <span><a href="index.html#type-sel">sel</a> list</span></code></div><div><p>The type for source selection.</p></div></div><div><div class="spec value" id="val-select" class="anchored"><a href="#val-select" class="anchor"></a><code><span class="keyword">val</span> select : <a href="../B0_build/index.html#type-t">B0_build.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="../B00_fexts/index.html#type-map">B00_fexts.map</a> <a href="../B00/Memo/index.html#type-fiber">B00.Memo.fiber</a></span></code></div><div><p><code>select b sels</code> selects in <code>b</code> the sources specified by <code>sels</code> and returns them mapped by their file extension (not <a href="../B00_std/index.html#file_exts">multiple file extension</a>). Each file is guaranteed to appear only once in the map.</p><p>Any relative path of <code>srcs</code> is made absolute to the current build unit with <a href="../B0_build/Unit/index.html#val-root_dir"><code>B0_build.Unit.root_dir</code></a>.</p><p><b>Important.</b> All files in the map that were selected via <code>`F</code>, <code>`D</code> and <code>`D_rec</code> are automatically <a href="../B00/Memo/index.html#val-file_ready">made ready</a> in the build. For those selected via <code>`Fiber</code> readyness determination is left to the fiber and the mechanisms it invokes.</p></div></div></div></body></html>