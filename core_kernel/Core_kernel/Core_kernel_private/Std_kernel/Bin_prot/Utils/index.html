<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Utils (core_kernel.Core_kernel.Core_kernel_private.Std_kernel.Bin_prot.Utils)</title><link rel="stylesheet" href="../../../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> – <a href="../../../../../index.html">core_kernel</a> &#x00BB; <a href="../../../../index.html">Core_kernel</a> &#x00BB; <a href="../../../index.html">Core_kernel_private</a> &#x00BB; <a href="../../index.html">Std_kernel</a> &#x00BB; <a href="../index.html">Bin_prot</a> &#x00BB; Utils</nav><header><h1>Module <code>Bin_prot.Utils</code></h1></header><div class="content"><aside><p>Utility functions for user convenience</p></aside><div><div class="spec value" id="val-size_header_length" class="anchored"><a href="#val-size_header_length" class="anchor"></a><code><span class="keyword">val</span> size_header_length : int</code></div><div><p><code>size_header_length</code> is the standard number of bytes allocated for the size header in size-prefixed bin-io payloads. This size-prefixed layout is used by the <code>bin_dump</code> and <code>bin_read_stream</code> functions below, as well as:</p><ul><li><code>Core.Bigstring.{read,write}_bin_prot</code></li><li><code>Core.Unpack_buffer.unpack_bin_prot</code></li><li><code>Async.{Reader,Writer}.{read,write}_bin_prot</code> among others.</li></ul><p>The size prefix is always 8 bytes at present. This is exposed so your program does not have to know this fact too.</p><p>We do not use a variable length header because we want to know how many bytes to read to get the size without having to peek into the payload.</p></div></div><div class="spec value" id="val-bin_read_size_header" class="anchored"><a href="#val-bin_read_size_header" class="anchor"></a><code><span class="keyword">val</span> bin_read_size_header : <span>int <a href="../../../../../../bin_prot/Bin_prot/Read/index.html#type-reader">Bin_prot.Read.reader</a></span></code></div><div><div class="spec value" id="val-bin_write_size_header" class="anchored"><a href="#val-bin_write_size_header" class="anchor"></a><code><span class="keyword">val</span> bin_write_size_header : <span>int <a href="../../../../../../bin_prot/Bin_prot/Write/index.html#type-writer">Bin_prot.Write.writer</a></span></code></div><div><p><code>bin_read_size_header</code> and <code>bin_write_size_header</code> are bin-prot serializers for the size header described above.</p></div></div><div><div class="spec value" id="val-bin_dump" class="anchored"><a href="#val-bin_dump" class="anchor"></a><code><span class="keyword">val</span> bin_dump : <span>?&#8288;header:bool</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../../../../bin_prot/Bin_prot/Type_class/index.html#type-writer">Bin_prot.Type_class.writer</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="../../../../../../bin_prot/Bin_prot/Common/index.html#type-buf">Bin_prot.Common.buf</a></code></div><div><p><code>bin_dump ?header writer v</code> uses <code>writer</code> to first compute the size of <code>v</code> in the binary protocol, then allocates a buffer of exactly this size, and then writes out the value. If <code>header</code> is <code>true</code>, the size of the resulting binary string will be prefixed as a signed 64bit integer.</p><dl><dt>returns</dt><dd><p>the buffer containing the written out value.</p></dd></dl><dl><dt>parameter header</dt><dd><p>default = <code>false</code></p></dd></dl><dl><dt>raises Failure</dt><dd><p>if the size of the value changes during writing, and any other exceptions that the binary writer in <code>writer</code> can raise.</p></dd></dl></div></div><div><div class="spec value" id="val-bin_read_stream" class="anchored"><a href="#val-bin_read_stream" class="anchor"></a><code><span class="keyword">val</span> bin_read_stream : <span>?&#8288;max_size:int</span> <span>&#45;&gt;</span> <span>read:<span>(<a href="../../../../../../bin_prot/Bin_prot/Common/index.html#type-buf">Bin_prot.Common.buf</a> <span>&#45;&gt;</span> <span>pos:int</span> <span>&#45;&gt;</span> <span>len:int</span> <span>&#45;&gt;</span> unit)</span></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../../../../bin_prot/Bin_prot/Type_class/index.html#type-reader">Bin_prot.Type_class.reader</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></div><div><p><code>bin_read_stream ?max_size ~read reader</code> reads binary protocol data from a stream as generated by the <code>read</code> function, which places data of a given length into a given buffer. Requires a header. The <code>reader</code> type class will be used for conversion to OCaml-values.</p><dl><dt>parameter max_size</dt><dd><p>default = nothing</p></dd></dl><dl><dt>raises Failure</dt><dd><p>if the size of the value disagrees with the one specified in the header, and any other exceptions that the binary reader associated with <code>reader</code> can raise.</p></dd></dl><dl><dt>raises Failure</dt><dd><p>if the size reported in the data header is longer than <code>max_size</code>.</p></dd></dl></div></div><aside><p>Conversion of binable types</p></aside><div class="spec module-type" id="module-type-Make_binable_spec" class="anchored"><a href="#module-type-Make_binable_spec" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Make_binable_spec/index.html">Make_binable_spec</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Of_minimal" class="anchored"><a href="#module-Of_minimal" class="anchor"></a><code><span class="keyword">module</span> <a href="Of_minimal/index.html">Of_minimal</a> : <span class="keyword">functor</span> (<a href="Of_minimal/argument-1-S/index.html">S</a> : <a href="../../../../../../bin_prot/Bin_prot/Binable/Minimal/module-type-S/index.html">Bin_prot.Binable.Minimal.S</a>) <span>&#45;&gt;</span> <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S/index.html">Bin_prot.Binable.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S/index.html#type-t">t</a> := <a href="Of_minimal/argument-1-S/index.html#type-t">S.t</a></code></div><div class="spec module" id="module-Make_binable" class="anchored"><a href="#module-Make_binable" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_binable/index.html">Make_binable</a> : <span class="keyword">functor</span> (<a href="Make_binable/argument-1-Bin_spec/index.html">Bin_spec</a> : <a href="module-type-Make_binable_spec/index.html">Make_binable_spec</a>) <span>&#45;&gt;</span> <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S/index.html">Bin_prot.Binable.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S/index.html#type-t">t</a> := <a href="Make_binable/argument-1-Bin_spec/index.html#type-t">Bin_spec.t</a></code></div><div class="spec module-type" id="module-type-Make_binable1_spec" class="anchored"><a href="#module-type-Make_binable1_spec" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Make_binable1_spec/index.html">Make_binable1_spec</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Make_binable1" class="anchored"><a href="#module-Make_binable1" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_binable1/index.html">Make_binable1</a> : <span class="keyword">functor</span> (<a href="Make_binable1/argument-1-Bin_spec/index.html">Bin_spec</a> : <a href="module-type-Make_binable1_spec/index.html">Make_binable1_spec</a>) <span>&#45;&gt;</span> <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S1/index.html">Bin_prot.Binable.S1</a> <span class="keyword">with</span> <span class="keyword">type</span> <span>'a <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S1/index.html#type-t">t</a></span> := <span><span class="type-var">'a</span> <a href="Make_binable1/argument-1-Bin_spec/index.html#type-t">Bin_spec.t</a></span></code></div><div class="spec module-type" id="module-type-Make_binable2_spec" class="anchored"><a href="#module-type-Make_binable2_spec" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Make_binable2_spec/index.html">Make_binable2_spec</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Make_binable2" class="anchored"><a href="#module-Make_binable2" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_binable2/index.html">Make_binable2</a> : <span class="keyword">functor</span> (<a href="Make_binable2/argument-1-Bin_spec/index.html">Bin_spec</a> : <a href="module-type-Make_binable2_spec/index.html">Make_binable2_spec</a>) <span>&#45;&gt;</span> <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S2/index.html">Bin_prot.Binable.S2</a> <span class="keyword">with</span> <span class="keyword">type</span> <span>('a, 'b) <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S2/index.html#type-t">t</a></span> := <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="Make_binable2/argument-1-Bin_spec/index.html#type-t">Bin_spec.t</a></span></code></div><div class="spec module-type" id="module-type-Make_binable3_spec" class="anchored"><a href="#module-type-Make_binable3_spec" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Make_binable3_spec/index.html">Make_binable3_spec</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Make_binable3" class="anchored"><a href="#module-Make_binable3" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_binable3/index.html">Make_binable3</a> : <span class="keyword">functor</span> (<a href="Make_binable3/argument-1-Bin_spec/index.html">Bin_spec</a> : <a href="module-type-Make_binable3_spec/index.html">Make_binable3_spec</a>) <span>&#45;&gt;</span> <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S3/index.html">Bin_prot.Binable.S3</a> <span class="keyword">with</span> <span class="keyword">type</span> <span>('a, 'b, 'c) <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S3/index.html#type-t">t</a></span> := <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="Make_binable3/argument-1-Bin_spec/index.html#type-t">Bin_spec.t</a></span></code></div><aside><p>Conversion of iterable types</p></aside><div class="spec module-type" id="module-type-Make_iterable_binable_spec" class="anchored"><a href="#module-type-Make_iterable_binable_spec" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Make_iterable_binable_spec/index.html">Make_iterable_binable_spec</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Make_iterable_binable" class="anchored"><a href="#module-Make_iterable_binable" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_iterable_binable/index.html">Make_iterable_binable</a> : <span class="keyword">functor</span> (<a href="Make_iterable_binable/argument-1-Iterable_spec/index.html">Iterable_spec</a> : <a href="module-type-Make_iterable_binable_spec/index.html">Make_iterable_binable_spec</a>) <span>&#45;&gt;</span> <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S/index.html">Bin_prot.Binable.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S/index.html#type-t">t</a> := <a href="Make_iterable_binable/argument-1-Iterable_spec/index.html#type-t">Iterable_spec.t</a></code></div><div class="spec module-type" id="module-type-Make_iterable_binable1_spec" class="anchored"><a href="#module-type-Make_iterable_binable1_spec" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Make_iterable_binable1_spec/index.html">Make_iterable_binable1_spec</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Make_iterable_binable1" class="anchored"><a href="#module-Make_iterable_binable1" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_iterable_binable1/index.html">Make_iterable_binable1</a> : <span class="keyword">functor</span> (<a href="Make_iterable_binable1/argument-1-Iterable_spec/index.html">Iterable_spec</a> : <a href="module-type-Make_iterable_binable1_spec/index.html">Make_iterable_binable1_spec</a>) <span>&#45;&gt;</span> <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S1/index.html">Bin_prot.Binable.S1</a> <span class="keyword">with</span> <span class="keyword">type</span> <span>'a <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S1/index.html#type-t">t</a></span> := <span><span class="type-var">'a</span> <a href="Make_iterable_binable1/argument-1-Iterable_spec/index.html#type-t">Iterable_spec.t</a></span></code></div><div class="spec module-type" id="module-type-Make_iterable_binable2_spec" class="anchored"><a href="#module-type-Make_iterable_binable2_spec" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Make_iterable_binable2_spec/index.html">Make_iterable_binable2_spec</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Make_iterable_binable2" class="anchored"><a href="#module-Make_iterable_binable2" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_iterable_binable2/index.html">Make_iterable_binable2</a> : <span class="keyword">functor</span> (<a href="Make_iterable_binable2/argument-1-Iterable_spec/index.html">Iterable_spec</a> : <a href="module-type-Make_iterable_binable2_spec/index.html">Make_iterable_binable2_spec</a>) <span>&#45;&gt;</span> <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S2/index.html">Bin_prot.Binable.S2</a> <span class="keyword">with</span> <span class="keyword">type</span> <span>('a, 'b) <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S2/index.html#type-t">t</a></span> := <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="Make_iterable_binable2/argument-1-Iterable_spec/index.html#type-t">Iterable_spec.t</a></span></code></div><div class="spec module-type" id="module-type-Make_iterable_binable3_spec" class="anchored"><a href="#module-type-Make_iterable_binable3_spec" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Make_iterable_binable3_spec/index.html">Make_iterable_binable3_spec</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Make_iterable_binable3" class="anchored"><a href="#module-Make_iterable_binable3" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_iterable_binable3/index.html">Make_iterable_binable3</a> : <span class="keyword">functor</span> (<a href="Make_iterable_binable3/argument-1-Iterable_spec/index.html">Iterable_spec</a> : <a href="module-type-Make_iterable_binable3_spec/index.html">Make_iterable_binable3_spec</a>) <span>&#45;&gt;</span> <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S3/index.html">Bin_prot.Binable.S3</a> <span class="keyword">with</span> <span class="keyword">type</span> <span>('a, 'b, 'c) <a href="../../../../../../bin_prot/Bin_prot/Binable/module-type-S3/index.html#type-t">t</a></span> := <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="Make_iterable_binable3/argument-1-Iterable_spec/index.html#type-t">Iterable_spec.t</a></span></code></div></div></body></html>