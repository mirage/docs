<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Bigbuffer (core_kernel.Core_kernel.Bigbuffer)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">core_kernel</a> &#x00BB; <a href="../index.html">Core_kernel</a> &#x00BB; Bigbuffer</nav><header><h1>Module <code>Core_kernel.Bigbuffer</code></h1><p>Extensible string buffers based on Bigstrings.</p><p>This module implements string buffers that automatically expand as necessary. It provides accumulative concatenation of strings in quasi-linear time (instead of quadratic time when strings are concatenated pairwise).</p><p>This implementation uses Bigstrings instead of strings. This removes the 16MB limit on buffer size (on 32-bit machines), and improves I/O-performance when reading/writing from/to channels.</p></header><div class="content"><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../../../base/Base/Buffer/module-type-S/index.html">Base.Buffer.S</a></code></span></summary><div><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></div><div><p>The abstract type of buffers.</p></div></div><div><div class="spec include"><div class="doc"><div class="spec value" id="val-sexp_of_t" class="anchored"><a href="#val-sexp_of_t" class="anchor"></a><code><span class="keyword">val</span> sexp_of_t : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../base/Base/Sexp/index.html#type-t">Base.Sexp.t</a></code></div></div></div></div><div><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : int <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>create n</code> returns a fresh buffer, initially empty. The <code>n</code> parameter is the initial size of the internal storage medium that holds the buffer contents. That storage is automatically reallocated when more than <code>n</code> characters are stored in the buffer, but shrinks back to <code>n</code> characters when <code>reset</code> is called.</p><p>For best performance, <code>n</code> should be of the same order of magnitude as the number of characters that are expected to be stored in the buffer (for instance, 80 for a buffer that holds one output line). Nothing bad will happen if the buffer grows beyond that limit, however. In doubt, take <code>n = 16</code> for instance.</p></div></div><div><div class="spec value" id="val-contents" class="anchored"><a href="#val-contents" class="anchor"></a><code><span class="keyword">val</span> contents : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></div><div><p>Return a copy of the current contents of the buffer. The buffer itself is unchanged.</p></div></div><div class="spec value" id="val-contents_bytes" class="anchored"><a href="#val-contents_bytes" class="anchor"></a><code><span class="keyword">val</span> contents_bytes : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bytes</code></div><aside><p><code>blit ~src ~src_pos ~dst ~dst_pos ~len</code> copies <code>len</code> characters from the current contents of the buffer <code>src</code>, starting at offset <code>src_pos</code> to bytes <code>dst</code>, starting at character <code>dst_pos</code>.</p><p>Raises <code>Invalid_argument</code> if <code>src_pos</code> and <code>len</code> do not designate a valid substring of <code>src</code>, or if <code>dst_pos</code> and <code>len</code> do not designate a valid substring of <code>dst</code>.</p></aside><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../../../base/Base/Blit/module-type-S_distinct/index.html">Base.Blit.S_distinct</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../base/Base/Blit/module-type-S_distinct/index.html#type-src">src</a> := <a href="index.html#type-t">t</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../base/Base/Blit/module-type-S_distinct/index.html#type-dst">dst</a> := bytes</code></span></summary><div class="spec value" id="val-blit" class="anchored"><a href="#val-blit" class="anchor"></a><code><span class="keyword">val</span> blit : <span>src:<a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>src_pos:int</span> <span>&#45;&gt;</span> <span>dst:bytes</span> <span>&#45;&gt;</span> <span>dst_pos:int</span> <span>&#45;&gt;</span> <span>len:int</span> <span>&#45;&gt;</span> unit</code></div><div class="spec value" id="val-blito" class="anchored"><a href="#val-blito" class="anchor"></a><code><span class="keyword">val</span> blito : <span>src:<a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>?&#8288;src_pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;src_len:int</span> <span>&#45;&gt;</span> <span>dst:bytes</span> <span>&#45;&gt;</span> <span>?&#8288;dst_pos:int</span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> unit</code></div><div class="spec value" id="val-unsafe_blit" class="anchored"><a href="#val-unsafe_blit" class="anchor"></a><code><span class="keyword">val</span> unsafe_blit : <span>src:<a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>src_pos:int</span> <span>&#45;&gt;</span> <span>dst:bytes</span> <span>&#45;&gt;</span> <span>dst_pos:int</span> <span>&#45;&gt;</span> <span>len:int</span> <span>&#45;&gt;</span> unit</code></div><div class="spec value" id="val-sub" class="anchored"><a href="#val-sub" class="anchor"></a><code><span class="keyword">val</span> sub : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>pos:int</span> <span>&#45;&gt;</span> <span>len:int</span> <span>&#45;&gt;</span> bytes</code></div><div class="spec value" id="val-subo" class="anchored"><a href="#val-subo" class="anchor"></a><code><span class="keyword">val</span> subo : <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bytes</code></div></details></div></div></div><div class="spec module" id="module-To_string" class="anchored"><a href="#module-To_string" class="anchor"></a><code><span class="keyword">module</span> <a href="To_string/index.html">To_string</a> : <a href="../../../base/Base/Blit/module-type-S_to_string/index.html">Base.Blit.S_to_string</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../base/Base/Blit/module-type-S_to_string/index.html#type-t">t</a> := <a href="index.html#type-t">t</a></code></div><div><div class="spec value" id="val-nth" class="anchored"><a href="#val-nth" class="anchor"></a><code><span class="keyword">val</span> nth : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> char</code></div><div><p>Gets the (zero-based) n-th character of the buffer. Raises <code>Invalid_argument</code> if index out of bounds.</p></div></div><div><div class="spec value" id="val-length" class="anchored"><a href="#val-length" class="anchor"></a><code><span class="keyword">val</span> length : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></div><div><p>Returns the number of characters currently contained in the buffer.</p></div></div><div><div class="spec value" id="val-clear" class="anchored"><a href="#val-clear" class="anchor"></a><code><span class="keyword">val</span> clear : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><p>Empties the buffer.</p></div></div><div><div class="spec value" id="val-reset" class="anchored"><a href="#val-reset" class="anchor"></a><code><span class="keyword">val</span> reset : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><p>Empties the buffer and deallocates the internal storage holding the buffer contents, replacing it with the initial internal storage of length <code>n</code> that was allocated by <code>create n</code>. For long-lived buffers that may have grown a lot, <code>reset</code> allows faster reclamation of the space used by the buffer.</p></div></div><div><div class="spec value" id="val-add_char" class="anchored"><a href="#val-add_char" class="anchor"></a><code><span class="keyword">val</span> add_char : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> char <span>&#45;&gt;</span> unit</code></div><div><p><code>add_char b c</code> appends the character <code>c</code> at the end of the buffer <code>b</code>.</p></div></div><div><div class="spec value" id="val-add_string" class="anchored"><a href="#val-add_string" class="anchor"></a><code><span class="keyword">val</span> add_string : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></div><div><p><code>add_string b s</code> appends the string <code>s</code> at the end of the buffer <code>b</code>.</p></div></div><div><div class="spec value" id="val-add_substring" class="anchored"><a href="#val-add_substring" class="anchor"></a><code><span class="keyword">val</span> add_substring : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>pos:int</span> <span>&#45;&gt;</span> <span>len:int</span> <span>&#45;&gt;</span> unit</code></div><div><p><code>add_substring b s pos len</code> takes <code>len</code> characters from offset <code>pos</code> in string <code>s</code> and appends them at the end of the buffer <code>b</code>.</p></div></div><div><div class="spec value" id="val-add_bytes" class="anchored"><a href="#val-add_bytes" class="anchor"></a><code><span class="keyword">val</span> add_bytes : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bytes <span>&#45;&gt;</span> unit</code></div><div><p><code>add_bytes b s</code> appends the bytes <code>s</code> at the end of the buffer <code>b</code>.</p></div></div><div><div class="spec value" id="val-add_subbytes" class="anchored"><a href="#val-add_subbytes" class="anchor"></a><code><span class="keyword">val</span> add_subbytes : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bytes <span>&#45;&gt;</span> <span>pos:int</span> <span>&#45;&gt;</span> <span>len:int</span> <span>&#45;&gt;</span> unit</code></div><div><p><code>add_subbytes b s pos len</code> takes <code>len</code> characters from offset <code>pos</code> in bytes <code>s</code> and appends them at the end of the buffer <code>b</code>.</p></div></div><div><div class="spec value" id="val-add_buffer" class="anchored"><a href="#val-add_buffer" class="anchor"></a><code><span class="keyword">val</span> add_buffer : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><p><code>add_buffer b1 b2</code> appends the current contents of buffer <code>b2</code> at the end of buffer <code>b1</code>. <code>b2</code> is not modified.</p></div></div></details></div></div></div><div><div class="spec value" id="val-big_contents" class="anchored"><a href="#val-big_contents" class="anchor"></a><code><span class="keyword">val</span> big_contents : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Bigstring/index.html#type-t">Bigstring.t</a></code></div><div><p>Return a copy of the current contents of the buffer as a bigstring. The buffer itself is unchanged.</p></div></div><div><div class="spec value" id="val-volatile_contents" class="anchored"><a href="#val-volatile_contents" class="anchor"></a><code><span class="keyword">val</span> volatile_contents : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Bigstring/index.html#type-t">Bigstring.t</a></code></div><div><p>Return the actual underlying bigstring used by this bigbuffer. No copying is involved. To be safe, use and finish with the returned value before calling any other function in this module on the same <code>Bigbuffer.t</code>.</p></div></div><div><div class="spec value" id="val-add_bigstring" class="anchored"><a href="#val-add_bigstring" class="anchor"></a><code><span class="keyword">val</span> add_bigstring : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Bigstring/index.html#type-t">Bigstring.t</a> <span>&#45;&gt;</span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></code></div><div><p><code>add_bigstring b s</code> appends the bigstring <code>s</code> at the end of the buffer <code>b</code>.</p></div></div><div><div class="spec value" id="val-add_bin_prot" class="anchored"><a href="#val-add_bin_prot" class="anchor"></a><code><span class="keyword">val</span> add_bin_prot : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../bin_prot/Bin_prot/Type_class/index.html#type-writer">Bin_prot.Type_class.writer</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></code></div><div><p><code>add_bin_prot b writer x</code> appends the bin-protted representation of <code>x</code> at the end of the buffer <code>b</code>.</p></div></div><div><div class="spec value" id="val-add_substitute" class="anchored"><a href="#val-add_substitute" class="anchor"></a><code><span class="keyword">val</span> add_substitute : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>(<a href="../../../base/Base/String/index.html#type-t">Base.String.t</a> <span>&#45;&gt;</span> <a href="../../../base/Base/String/index.html#type-t">Base.String.t</a>)</span> <span>&#45;&gt;</span> <a href="../../../base/Base/String/index.html#type-t">Base.String.t</a> <span>&#45;&gt;</span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></code></div><div><p><code>add_substitute b f s</code> appends the string pattern <code>s</code> at the end of the buffer <code>b</code> with substitution. The substitution process looks for variables into the pattern and substitutes each variable name by its value, as obtained by applying the mapping <code>f</code> to the variable name. Inside the string pattern, a variable name immediately follows a non-escaped <code>$</code> character and is one of the following:</p><ul><li>a non empty sequence of alphanumeric or <code>_</code> characters,</li><li>an arbitrary sequence of characters enclosed by a pair of matching parentheses or curly brackets.</li></ul><p>An escaped <code>$</code> character is a <code>$</code> that immediately follows a backslash character; it then stands for a plain <code>$</code>. Raise <code>Caml.Not_found</code> or <code>Not_found_s</code> if the closing character of a parenthesized variable cannot be found.</p></div></div><div class="spec module" id="module-Format" class="anchored"><a href="#module-Format" class="anchor"></a><code><span class="keyword">module</span> <a href="Format/index.html">Format</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Printf" class="anchored"><a href="#module-Printf" class="anchor"></a><code><span class="keyword">module</span> <a href="Printf/index.html">Printf</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></div></body></html>