<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Logs_syslog_lwt (logs-syslog.Logs_syslog_lwt)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> – <a href="../index.html">logs-syslog</a> &#x00BB; Logs_syslog_lwt</nav><header><h1>Module <code>Logs_syslog_lwt</code></h1><p>Logs reporter via syslog, using Lwt</p><p>Please read <a href="../Logs_syslog/index.html"><code>Logs_syslog</code></a> first.</p></header><nav class="toc"><ul><li><a href="#lwt_example">Example usage</a></li></ul></nav><div class="content"><div><div class="spec value" id="val-udp_reporter" class="anchored"><a href="#val-udp_reporter" class="anchor"></a><code><span class="keyword">val</span> udp_reporter : <span>?&#8288;hostname:string</span> <span>&#45;&gt;</span> <a href="../../lwt/Lwt_unix/index.html#type-inet_addr">Lwt_unix.inet_addr</a> <span>&#45;&gt;</span> <span>?&#8288;port:int</span> <span>&#45;&gt;</span> <span>?&#8288;truncate:int</span> <span>&#45;&gt;</span> <span>?&#8288;facility:<a href="../../syslog-message/Syslog_message/index.html#type-facility">Syslog_message.facility</a></span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span><a href="../../logs/Logs/index.html#type-reporter">Logs.reporter</a> <a href="../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>udp_reporter ~hostname remote_ip ~port ~truncate ()</code> is <code>reporter</code>, which sends syslog message using the given <code>hostname</code> to <code>remote_ip, remote_port</code> via UDP. Each message is truncated to <code>truncate</code> bytes (defaults to 65535). The <code>hostname</code> default to <code>Lwt_unix.gethostname ()</code>, <code>port</code> defaults to 514. <code>facility</code> is the default syslog facility (see <a href="../Logs_syslog/index.html#val-message"><code>Logs_syslog.message</code></a>).</p></div></div><div><div class="spec value" id="val-tcp_reporter" class="anchored"><a href="#val-tcp_reporter" class="anchor"></a><code><span class="keyword">val</span> tcp_reporter : <span>?&#8288;hostname:string</span> <span>&#45;&gt;</span> <a href="../../lwt/Lwt_unix/index.html#type-inet_addr">Lwt_unix.inet_addr</a> <span>&#45;&gt;</span> <span>?&#8288;port:int</span> <span>&#45;&gt;</span> <span>?&#8288;truncate:int</span> <span>&#45;&gt;</span> <span>?&#8288;framing:<a href="../Logs_syslog/index.html#type-framing">Logs_syslog.framing</a></span> <span>&#45;&gt;</span> <span>?&#8288;facility:<a href="../../syslog-message/Syslog_message/index.html#type-facility">Syslog_message.facility</a></span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span><span><span>(<a href="../../logs/Logs/index.html#type-reporter">Logs.reporter</a>, string)</span> <a href="../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>tcp_reporter ~hostname remote_ip ~port ~truncate ~framing ()</code> is <code>Ok reporter</code> or <code>Error msg</code>. The <code>reporter</code> sends each log message to <code>remote_ip, port</code> via TCP. If the initial TCP connection to the <code>remote_ip</code> fails, an <code>Error msg</code> is returned instead. If the TCP connection fails, the log message is reported to standard error, and attempts are made to re-establish the TCP connection. Each syslog message is truncated to <code>truncate</code> bytes (defaults to 0, thus no truncation). Each syslog message is framed (using <code>framing</code>), the default strategy is to append a single byte containing 0. The <code>hostname</code> default to <code>Lwt_unix.gethostname ()</code>, <code>port</code> to 514. <code>facility</code> is the default syslog facility (see <a href="../Logs_syslog/index.html#val-message"><code>Logs_syslog.message</code></a>).</p></div></div><div><div class="spec value" id="val-unix_reporter" class="anchored"><a href="#val-unix_reporter" class="anchor"></a><code><span class="keyword">val</span> unix_reporter : <span>?&#8288;socket:string</span> <span>&#45;&gt;</span> <span>?&#8288;truncate:int</span> <span>&#45;&gt;</span> <span>?&#8288;framing:<a href="../Logs_syslog/index.html#type-framing">Logs_syslog.framing</a></span> <span>&#45;&gt;</span> <span>?&#8288;facility:<a href="../../syslog-message/Syslog_message/index.html#type-facility">Syslog_message.facility</a></span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span><span><span>(<a href="../../logs/Logs/index.html#type-reporter">Logs.reporter</a>, string)</span> <a href="../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>unix_reporter ~socket ~truncate ~framing ()</code> is <code>Ok reporter</code> or <code>Error msg</code>. The <code>reporter</code> sends each log message via syslog to <code>socket</code> (which defaults to <code>&quot;/dev/log&quot;</code>). If the initial connection to the socket fails, the log message is reported to standard error, and attempts are made to re-establish the connection. A syslog message is truncated to <code>truncate</code> bytes and is framed according to the given <code>framing</code>. The default for <code>truncate</code> is <code>65536</code> if <code>framing</code> is not provided and <code>0</code> otherwise. If <code>framing</code> is not provided, then the socket used is a datagram socket (as for <a href="index.html#val-udp_reporter"><code>udp_reporter</code></a>) otherwise a stream socket is used (as for <a href="index.html#val-tcp_reporter"><code>tcp_reporter</code></a>). <code>facility</code> is the default syslog facility (see <a href="../Logs_syslog/index.html#val-message"><code>Logs_syslog.message</code></a>).</p></div></div><h3 id="lwt_example"><a href="#lwt_example" class="anchor"></a>Example usage</h3><aside><p>To install a Lwt syslog reporter, sending via UDP to localhost, use the following snippet:</p><pre><code>let install_logger () =
  udp_reporter (Unix.inet_addr_of_string &quot;127.0.0.1&quot;) () &gt;|= fun r -&gt;
  Logs.set_reporter r

let _ = Lwt_main.run (install_logger ())</code></pre><p>And via TCP:</p><pre><code>let install_logger () =
  tcp_reporter (Unix.inet_addr_of_string &quot;127.0.0.1&quot;) () &gt;|= function
    | Ok r -&gt; Logs.set_reporter r
    | Error e -&gt; print_endline e

let _ = Lwt_main.run (install_logger ())</code></pre></aside></div></body></html>